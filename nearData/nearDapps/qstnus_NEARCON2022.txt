*GitHub Repository "qstnus/NEARCON2022"*

'''--- .cargo/config.toml ---
[target.wasm32-unknown-unknown]
rustflags = ["-C", "link-arg=-s"]
'''
'''--- .idea/misc.xml ---
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ProjectRootManager">
    <output url="file://$PROJECT_DIR$/out" />
  </component>
</project>
'''
'''--- .idea/modules.xml ---
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ProjectModuleManager">
    <modules>
      <module fileurl="file://$PROJECT_DIR$/nearcon-2022.iml" filepath="$PROJECT_DIR$/nearcon-2022.iml" />
    </modules>
  </component>
</project>
'''
'''--- .idea/vcs.xml ---
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="VcsDirectoryMappings">
    <mapping directory="" vcs="Git" />
  </component>
</project>
'''
'''--- Cargo.toml ---

[package]
name = "on-chain-chat"
version = "0.1.0"
edition = "2021"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[lib]
crate-type = ["rlib", "cdylib"]

[dependencies]
clap = { version = "3.0.0-beta.2", optional = true }
near-sdk = { version = "4.0.0-pre.7" }
serde = { version = "1", features = ["derive"] }
serde_json = "1.0.81"
near-contract-standards = "4.0.0-pre.4"
hex = "0.4.2"
uint = { version = "0.8.3", default-features = false }

'''
'''--- src/lib.rs ---
use near_sdk::{AccountId, BorshStorageKey, env, near_bindgen};
use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
use near_sdk::collections::{Vector};
use near_sdk::json_types::{U64};
use near_sdk::serde::{Deserialize, Serialize};

#[derive(BorshStorageKey, BorshSerialize)]
pub enum StorageKeys {
    StoreStorageKey
}

#[derive(Clone, Debug, Deserialize, Serialize, BorshDeserialize, BorshSerialize)]
pub struct MessageArgs {
    pub from_message_account: AccountId,
    pub to_message_account: AccountId,
    pub date_created: U64,
    pub body: String
}

#[near_bindgen]
#[derive(BorshSerialize, BorshDeserialize, Serialize, Deserialize)]
#[serde(crate = "near_sdk::serde")]
pub struct Store {
    pub conversations: Vector<MessageArgs>
}

impl Default for Store {
    fn default() -> Self {
        env::panic_str("NOT_INITIALIZED_YET");
    }
}

#[near_bindgen]
impl Store {
    #[init(ignore_state)]
    pub fn init() -> Self {
        assert!(!env::state_exists());
        Self {
            conversations: Vector::new(StorageKeys::StoreStorageKey)
        }
    }

    #[payable]
    pub fn new_message(
        &mut self,
        from: AccountId,
        to: AccountId,
        body: String,
    ) {
        env::log_str(format!("NEARCON_2022::new_message() Sender: {} Receiver: {}  body: {}",
                             env::predecessor_account_id().as_str(),
                             to.clone().as_str(),
                             body.clone().as_str())
            .as_str());

        let message_args = MessageArgs {
            from_message_account: from,
            to_message_account: to,
            date_created: U64(env::block_timestamp()),
            body
        };
        self.conversations.push(&message_args)
    }

    pub fn get_messages(
        &self,
    ) -> Vec<MessageArgs> {
        self.conversations.to_vec()
    }
}

'''