*GitHub Repository "jiangchi/near-dapp-1"*

'''--- Cargo.toml ---
[package]
name = "near-dapp-1"
version = "0.1.0"
authors = ["Near Inc <hello@near.org>"]
edition = "2018"

[lib]
crate-type = ["cdylib", "rlib"]

[dependencies]
near-sdk = "4.0.0"

[profile.release]
codegen-units = 1
# Tell `rustc` to optimize for small code size.
opt-level = "s"
lto = true
debug = false
panic = "abort"
# Opt into extra safety checks on arithmetic operations https://stackoverflow.com/a/64136471/249801
overflow-checks = true

'''
'''--- build.sh ---
#!/bin/bash
set -e

RUSTFLAGS='-C link-arg=-s' cargo build --target wasm32-unknown-unknown --release
cp target/wasm32-unknown-unknown/release/rust_template.wasm ./res/

near login //第一次需要登录，之后合约修改，不需要此步骤
near deploy --wasmFile target/wasm32-unknown-unknown/release/near-dapp-1.wasm --accountId putong333.testnet

near call putong333.testnet get_puzzle_number  --accountId putong333.testnet
//注意cmd下需要将“转义，加\
near call putong333.testnet guess_solution '{\"solution\":\"88\"}'  --accountId putong333.testnet  

near call putong333.testnet set_solution '{\"solution\":\"33\"}'  --accountId putong333.testnet

cargo test data_input::tests::test_guess_solution -- --exact
'''
'''--- src/data_input.rs ---
use crate::*;
use std::cmp::Ordering;

use near_sdk::{near_bindgen,env};
#[near_bindgen]
impl Contract {
    pub fn get_puzzle_number(&self) -> String {
        self.crossword_solution.to_string()
    }

    pub fn set_solution(&mut self, solution: String)  {
        self.crossword_solution = solution;
    }

    /// .
    pub fn guess_solution(&mut self, solution: String) -> &str {
        if solution == self.crossword_solution {

            env::log_str("You guessed right!");
           // self.crossword_solution.to_string() +r#"You guessed right!"#
        } else {
            env::log_str("Try again.");
           // self.crossword_solution.to_string() +r#"Try again."#
        }
        match self.crossword_solution.cmp(&solution) {
            Ordering::Less => r#"You guessed Too big!!"#,
            Ordering::Greater => r#"You guessed Too small!!"#,
            Ordering::Equal =>r#"You guessed is right!!"#,

    }
    
    }

}

/*
 * the rest of this file sets up unit tests
 * to run these, the command will be:
 * cargo test --package rust-template -- --nocapture
 * Note: 'rust-template' comes from cargo.toml's 'name' key
 */
#[cfg(not(target = "wasm32"))]
// use the attribute below for unit tests
#[cfg(test)]
mod tests {
    use near_sdk::{VMContext, test_utils::VMContextBuilder, testing_env};

    use super::*;
    
    fn get_context(is_view: bool) -> VMContext {
        VMContextBuilder::new()
            .signer_account_id("bob_near".parse().unwrap())
            .is_view(is_view)
            .build()
    }
    #[test] 
    pub fn test_guess_solution() {
       
       //let context = get_context(false);
        let  contract = Contract {crossword_solution: "66".to_string()};
       let x= Contract::get_puzzle_number(&contract);
       
        assert_eq!("66",x,"与设置的数据不相符！");
      

    }
    // TESTS HERE
}
'''
'''--- src/lib.rs ---
use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};

use near_sdk::{near_bindgen};

mod data_input;

//const PUZZLE_NUMBER: u8 = 1;

#[near_bindgen]
#[derive(Default, BorshDeserialize, BorshSerialize)]
pub struct Contract {
    crossword_solution: String
}

'''