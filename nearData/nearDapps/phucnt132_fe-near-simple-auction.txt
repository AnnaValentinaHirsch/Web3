*GitHub Repository "phucnt132/fe-near-simple-auction"*

'''--- package.json ---
{
    "name": "fe-nft-auction",
    "version": "1.0.0",
    "main": "index.js",
    "license": "MIT",
    "dependencies": {
        "near-api-js": "^0.43.1",
        "regenerator-runtime": "^0.13.9"
    },
    "devDependencies": {
        "parcel": "^2.0.1"
    },
    "scripts": {
        "start": "echo The app is starting! It will automatically open in your browser when ready &&  parcel src/index.html --open"
    }
}
'''
'''--- src/config.js ---
const CONTRACT_NAME = 'simple_auction.testnet'

function getConfig(env) {
    switch (env) {

        case 'production':
        case 'mainnet':
            return {
                networkId: 'mainnet',
                nodeUrl: 'https://rpc.mainnet.near.org',
                contractName: CONTRACT_NAME,
                walletUrl: 'https://wallet.near.org',
                helperUrl: 'https://helper.mainnet.near.org',
                explorerUrl: 'https://explorer.mainnet.near.org',
            }
        case 'development':
        case 'testnet':
            return {
                networkId: 'testnet',
                nodeUrl: 'https://rpc.testnet.near.org',
                contractName: CONTRACT_NAME,
                walletUrl: 'https://wallet.testnet.near.org',
                helperUrl: 'https://helper.testnet.near.org',
                explorerUrl: 'https://explorer.testnet.near.org',
            }
        case 'betanet':
            return {
                networkId: 'betanet',
                nodeUrl: 'https://rpc.betanet.near.org',
                contractName: CONTRACT_NAME,
                walletUrl: 'https://wallet.betanet.near.org',
                helperUrl: 'https://helper.betanet.near.org',
                explorerUrl: 'https://explorer.betanet.near.org',
            }
        case 'local':
            return {
                networkId: 'local',
                nodeUrl: 'http://localhost:3030',
                keyPath: `${process.env.HOME}/.near/validator_key.json`,
                walletUrl: 'http://localhost:4000/wallet',
                contractName: CONTRACT_NAME,
            }
        case 'test':
        case 'ci':
            return {
                networkId: 'shared-test',
                nodeUrl: 'https://rpc.ci-testnet.near.org',
                contractName: CONTRACT_NAME,
                masterAccount: 'test.near',
            }
        case 'ci-betanet':
            return {
                networkId: 'shared-test-staging',
                nodeUrl: 'https://rpc.ci-betanet.near.org',
                contractName: CONTRACT_NAME,
                masterAccount: 'test.near',
            }
        default:
            throw Error(`Unconfigured environment '${env}'. Can be configured in src/config.js.`)
    }
}

module.exports = getConfig
'''
'''--- src/index.html ---
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple NFT Auction</title>
    <link rel="stylesheet" href="./main.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>My Simple NFT Auction</h1>
            <div class="btn-group" role="group" aria-label="Basic example">
                <button class="btn btn-primary nav-link" id="signin">Sign In</button>
                <button class="btn btn-primary nav-link" id="signout">Sign Out</button>
                <button class="btn btn-primary nav-link" id="home">Home</button>
                <button class="btn btn-primary nav-link" id="auction">Auctions</button>
                <button class="btn btn-primary nav-link" id="mint">Mint NFT</button>
                <button class="btn btn-primary nav-link" id="create-auction">Create Auction</button>
            </div>

        </div>

        <div class=" container content">

        </div>
    </div>

    <script type="module" src="./index.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>

</html>
'''
'''--- src/index.js ---
import "regenerator-runtime/runtime";
import * as nearAPI from "near-api-js";
import { initContract, login, logout } from "./utils";
const { utils } = nearAPI;
import getConfig from "./config";
const { networkId } = getConfig(process.env.NODE_ENV || "development");

console.log(networkId);
document.querySelector("#home").onclick = async() => {
    renderHome();
};
document.querySelector("#auction").onclick = async() => {
    renderAuction();
};

document.querySelector("#mint").onclick = async() => {
    renderMint();
};

document.querySelector("#create-auction").onclick = async() => {
    renderCreateAuction();
};
// Display the signed-out-flow container
function signedOutFlow() {
    document.querySelector("#signin").innerText = "Sign In";
    document.querySelector("#signout").disabled = true;
    document.querySelector("#mint").disabled = true;
    document.querySelector("#signin").onclick = login;
}

// Displaying the signed in flow container and fill in account-specific data
function signedInFlow() {
    document.querySelector("#signin").innerText = window.accountId;
    document.querySelector("#signout").onclick = logout;
    document.querySelector("#signin").onclick = () => {};
}

window.nearInitPromise = initContract()
    .then(() => {
        if (window.walletConnection.isSignedIn()) signedInFlow();
        else signedOutFlow();
    })
    .catch(console.error);

const getTokenData = async(tokenId) => {
    let res = await contract.nft_token({ token_id: tokenId });

    return res;
};

const renderMint = async() => {
    document.querySelector(".content").innerHTML = `
    <form id="mint-form">
    <div class="form-group">
        <label for="tokenId">Token ID</label>
        <input  type="text" class="form-control" id="token-id" placeholder="Token ID">
    </div>
    <div class="form-group">
        <label for="tokenOwnerId">Token Owner ID</label>
        <input type="text" class="form-control" id="token-owner-id" placeholder="Token Owner ID">
    </div>
    <div class="form-group">
        <label for="title">Token Title</label>
        <input type="text" class="form-control" id="title" placeholder="Title">
    </div>
    <div class="form-group">
        <label for="description">Description</label>
        <input type="text" class="form-control" id="description" placeholder="Description">
    </div>
    <div class="form-group">
        <label for="media">Token URI</label>
        <input type="text" class="form-control" id="media" placeholder="Token URI">
    </div>

    <button type="submit" class="btn btn-primary">Mint</button>
</form>
    `;
    document.querySelector("#mint-form").addEventListener("submit", async(e) => {
        e.preventDefault();
        let tokenId = document.querySelector("#token-id").value;
        let tokenOwnerId = document.querySelector("#token-owner-id").value;
        let title = document.querySelector("#title").value;
        let description = document.querySelector("#description").value;
        let media = document.querySelector("#media").value;
        console.log(tokenId, tokenOwnerId, title, description, media);
        try {
            let callRes = await contract.mint({
                    token_id: tokenId,
                    token_owner_id: tokenOwnerId,
                    token_metadata: {
                        title: title,
                        description: description,
                        media: media,
                    },
                },
                300000000000000,
                utils.format.parseNearAmount("0.1")
            );
            console.log(callRes);
        } catch (err) {
            console.log(err);
        }
    });
};

const renderCreateAuction = async() => {
    document.querySelector(".content").innerHTML = `
    <form id="create-auction-form">
    <div class="form-group">
        <label for="tokenId">Token ID</label>
        <input type="text" class="form-control" id="token-id" placeholder="Token ID">
    </div>
    <div class="form-group">
        <label for="start-price">Start Price</label>
        <input type="text" class="form-control" id="start-price" placeholder="Start Price">
    </div>
    <div class="form-group">
        <label for="start-time">Start Time</label>
        <input type="datetime-local" class="form-control" id="start-time" placeholder="Start Time">
    </div>
    <div class="form-group">
        <label for="end-time">End Time</label>
        <input type="datetime-local" class="form-control" id="end-time" placeholder="End Time">
    </div>

    <button type="submit" class="btn btn-primary">Create Auction</button>
</form>
    `;
    document
        .querySelector("#create-auction-form")
        .addEventListener("submit", async(e) => {
            e.preventDefault();
            let tokenId = document.querySelector("#token-id").value;
            let startPrice = utils.format.parseNearAmount(
                document.querySelector("#start-price").value
            );
            let startTime =
                Date.parse(document.querySelector("#start-time").value) / 1000;
            let endTime =
                Date.parse(document.querySelector("#end-time").value) / 1000;
            console.log(tokenId, startPrice, startTime, endTime);
            let resCall = await contract.create_auction({
                    auction_token: tokenId,
                    start_price: parseInt(startPrice),
                    start_time: startTime,
                    end_time: endTime,
                },
                300000000000000,
                utils.format.parseNearAmount("1")
            );

            console.log(resCall);
        });
};

const renderHome = async() => {
    const totalSupply = parseInt(await contract.nft_total_supply());
    let limit = totalSupply > 6 ? 6 : totalSupply;
    let nfts = await contract.nft_tokens({ from_index: "0", limit: limit });
    document.querySelector(".content").innerHTML = "";
    nfts.forEach(async(nft, index) => {
        console.log(nft);
        let response = await fetch(nft.metadata.media);
        let data = await response.json();
        if (data.image.includes("ipfs://")) {
            data.image = data.image.replace("ipfs://", "https://ipfs.io/ipfs/");
            console.log(data.image);
        }
        let card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <div class="card-header">
                <p>Token ID: ${nft.token_id}</p>
                <h3 class="card-title">${nft.metadata.title}</h3>
                <p class="owner"> Owner ID: ${nft.owner_id}<p>
                <p class="card-description">${nft.metadata.description}</p>
            </div>
            <div class="card-content">
                <div class="card-img">
                    <img  src="${data.image}" />
                </div>
            </div>
`;

        document.querySelector(".content").appendChild(card);
    });
};
const renderAuction = async() => {
    try {
        document.querySelector(".content").innerHTML = `
            <div style="width: 100%; margin: 20px;" class="bid-control">
                <input type="text" id="auction-id" placeholder="Auction ID">
                <input type="text" id="bid-price" placeholder="Bid Price">
                <button class="btn btn-primary" id="bid" class="bid">Bid</button>
                <br />
                <input type="text" id="auction-id-claim" placeholder="Auction ID">
                <button class="btn btn-primary" id="claim-nft">Claim NFT</button>
            </div>
            `;
        for (let i = 0; i < 10; i++) {
            let auction = await contract.get_auction({ auction_id: i });
            console.log(auction);
            let token = await getTokenData(auction.auction_token);
            let response = await fetch(token.metadata.media);
            let data = await response.json();
            if (data.image.includes("ipfs://")) {
                data.image = data.image.replace("ipfs://", "https://ipfs.io/ipfs/");
                console.log(data.image);
            }
            console.log(token);
            let card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
                    <div class="card-header">
                        <p>Auction ID: ${auction.auction_id}</p>
                        <p class="token-id">Token ID: ${
                          auction.auction_token
                        }</p>
                        <h3 class="card-title">Title: ${
                          token.metadata.title
                        }</h3>
                        <p class="owner"> Owner ID: ${auction.owner}</p>
                        <p class="current-price">Current Price: ${
                          auction.current_price / 10 ** 24
                        } NEAR</p>
                        <p class="current-winner">Current winner: ${
                          auction.winner || "no winner"
                        }</p>
                        <p class="end-time">End: ${new Date(
                          auction.end_time / 1_000_000
                        )}</p>
                    </div>
                    <div class="card-content">
                        <div class="card-img">
                            <img  src="${data.image}" />
                        </div>
                    </div>

                `;
            document.querySelector(".content").appendChild(card);
        }
    } catch (err) {
        console.log(err);
    }
    document.querySelector("#bid").onclick = async() => {
        let auctionId = parseInt(document.querySelector("#auction-id").value);
        let bidPrice = utils.format.parseNearAmount(
            document.querySelector("#bid-price").value
        );
        console.log(auctionId, bidPrice);
        let res = await contract.bid({ auction_id: auctionId },
            300000000000000,
            bidPrice
        );
        console.log(res);
    };

    document.querySelector("#claim-nft").onclick = async() => {
        let auctionId = parseInt(document.querySelector("#auction-id-claim").value);
        console.log(auctionId);
        contract.claim_nft({ auction_id: auctionId }, 300000000000000, 1);
    };
};
setTimeout(renderHome);
'''
'''--- src/main.css ---
.header {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

.btn-group {
    margin: 20px;
}

.button {
    margin-left: 20px;
}

.container {
    background-color: rgb(213, 255, 252);
}

.content {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    height: 800px
}

form {
    margin: 20px;
    width: 80%;
}

.card {
    margin: 10px;
    width: 320px;
    height: 650px;
    align-items: center;
}

p,
h1,
h2,
h3,
h4,
h5,
h6 {
    margin-top: 0px !important;
    margin-bottom: 8px !important;
}

.card-header {
    width: 100%;
    height: 300px
}

img {
    border-radius: 5px;
    width: 100%;
}
'''
'''--- src/utils.js ---
import { connect, Contract, keyStores, WalletConnection, utils } from 'near-api-js'
import getConfig from './config'

const nearConfig = getConfig(process.env.NODE_ENV || 'development')

// Initialize contract & set global variables
export async function initContract() {
    // Initialize connection to the NEAR testnet
    const near = await connect(Object.assign({ deps: { keyStore: new keyStores.BrowserLocalStorageKeyStore() } }, nearConfig))

    // Initializing Wallet based Account. It can work with NEAR testnet wallet that
    // is hosted at https://wallet.testnet.near.org
    window.walletConnection = new WalletConnection(near)

    // Getting the Account ID. If still unauthorized, it's just empty string
    window.accountId = window.walletConnection.getAccountId()

    // Initializing our contract APIs by contract name and configuration
    window.contract = await new Contract(window.walletConnection.account(), nearConfig.contractName, {
        // View methods are read only. They don't modify the state, but usually return some value.
        viewMethods: ['nft_tokens', 'nft_token', 'nft_total_supply', 'get_auction'],
        // Change methods can modify the state. But you don't receive the returned value when called.
        changeMethods: ['set_greeting', 'mint', 'create_auction', 'bid', 'claim_nft'],
    })
}

export function logout() {
    window.walletConnection.signOut()
        // reload page
    window.location.replace(window.location.origin + window.location.pathname)
}

export function login() {
    // Allow the current app to make calls to the specified contract on the
    // user's behalf.
    // This works by creating a new access key for the user's account and storing
    // the private key in localStorage.
    window.walletConnection.requestSignIn(nearConfig.contractName)
}
'''