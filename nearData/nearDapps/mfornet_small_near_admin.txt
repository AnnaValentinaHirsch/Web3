*GitHub Repository "mfornet/small_near_admin"*

'''--- Cargo.toml ---
[package]
name = "small-admin"
version = "0.1.0"
authors = ["Marcelo Fornet marcelo@aurora.dev"]
edition = "2018"

[lib]
crate-type = ["cdylib", "rlib"]

[profile.release]
codegen-units = 1
# Tell `rustc` to optimize for small code size.
opt-level = "z"
lto = true
debug = false

[dependencies]
near-sdk = "4.0.0-pre.1"

'''
'''--- README.md ---
# Small Admin

NEAR Contract to test admin interface. Admin can be set to any NEAR account, including a [DAO](https://astrodao.com/).

## Compile

```
./build.sh
```

[Contract builder](https://github.com/near/near-sdk-rs/tree/master/contract-builder) is recommended for reproducing the same binary while compiling on different machines.

Final binary will be on `res/small_admin.wasm`

## Deploy

Following commands are using [near-cli](https://github.com/near/near-cli)

```
near deploy small_admin.near res/small_admin.wasm '{"owner": "the_real_admin.near"}'
```

Notice on deployment a Full Access Key is created for this contract. The contract itself is considered an admin, so in order to remove it, all Full Access Keys must be removed (it should be only one during deployment).

## View methods

### get_owner

```
near view small_admin.near get_owner
```

### get_counter

Everyone can see the counter but only admin can increase it.

```
near view small_admin.near get_counter
```

## Call methods

Only the owner can call the following methods.

### increase_counter

```
near call small_admin.near increase_counter --accountId the_real_admin.near
```

### set_owner

New owner can be any NEAR account id, including a DAO account. Notice this replace the previous owner for the new one.

```
near call small_admin.near set_owner '{"owner": "dao_admin.sputnik-dao.near"}' --accountId the_real_admin.near
```

'''
'''--- build.sh ---
#!/bin/bash
env RUSTFLAGS='-C link-arg=-s' cargo build --target wasm32-unknown-unknown --release
cp target/wasm32-unknown-unknown/release/small_admin.wasm res/
ls -la res/small_admin.wasm

'''
'''--- src/lib.rs ---
use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
use near_sdk::json_types::U64;
use near_sdk::{env, near_bindgen, AccountId, PanicOnDefault};

#[near_bindgen]
#[derive(BorshDeserialize, BorshSerialize, PanicOnDefault)]
pub struct Contract {
    pub owner: AccountId,
    pub counter: u64,
}

#[near_bindgen]
impl Contract {
    #[init]
    pub fn new(owner: AccountId) -> Self {
        Self { owner, counter: 0 }
    }

    pub fn set_owner(&mut self, owner: AccountId) {
        self.assert_called_by_owner();
        self.owner = owner;
    }

    pub fn get_owner(&self) -> AccountId {
        self.owner.clone()
    }

    pub fn get_counter(&self) -> U64 {
        self.counter.into()
    }

    pub fn increase_counter(&mut self) {
        self.assert_called_by_owner();
        self.counter += 1;
    }
}

impl Contract {
    fn called_by_owner(&self) -> bool {
        let caller = env::predecessor_account_id();
        caller == self.owner || caller == env::current_account_id()
    }

    fn assert_called_by_owner(&self) {
        assert!(self.called_by_owner())
    }
}

'''