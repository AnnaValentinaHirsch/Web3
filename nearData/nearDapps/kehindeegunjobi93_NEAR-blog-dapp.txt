*GitHub Repository "kehindeegunjobi93/NEAR-blog-dapp"*

'''--- README.md ---
# Loom Video
https://www.loom.com/share/4ffbe9960e30409292bb2d9715cb530a

# Cloning the project
After cloning the project please run

```
yarn
```
in order to install all of the necessary packages for the project to run correctly.

# Building and Deploying the contract
The contract is located in under the blog-dapp/assembly folders, after editing the contract you can run

```
yarn build:release
```

in order to build the contract and get the .wasm file , 
Next step is to deploy the contract, you can run

```
yarn deploy
```

This will create a test account and deploy the contract into it.

after the contract is deployed, it is necessary to run the following command in the terminal in order to be able to run the contract

export CONTRACT=ACCOUNT_ID

# Running the contract
You can run this contract in the terminal by calling the exported functions

## Create
- Takes 2 parameters (a title and a post). Both are strings.
- Title must be more than a letter.
- Returns a blog data
- **Example call:** blog-dapp % near call $CONTRACT create '{"title":"the title", "post":"the post"}' --accountId $YOUR_ACCOUNT_ID

## GetById
- Takes 1 parameter (the id). A number.
- Id must be a valid positive number.
- Returns a blog data that is that particular id
- **Example call:** blog-dapp % near call $CONTRACT getById '{"id":123456789}' --accountId $YOUR_ACCOUNT_ID

## Get
- Takes 2 parameter (the offset and limit).
- Both parameters must be numbers. 
- Offset paraemeter is the number of blogs to SKIP from the beginning of the data.
- Returns a list of 10 blogs if you do not change the limit parameter value.
- **Example call:** blog-dapp % near call $CONTRACT get '{"offset":0, "limit":10}' --accountId $YOUR_ACCOUNT_ID

## Update
- Takes 2 parameter (the id and updates). The offset parameter is not required though and limit also has a default value of 10.
- Get a blog data that is that particular id and updates it with the updates parameter.
- Changes existing blog with updated data
- **Example call:** blog-dapp % near call $CONTRACT update '{"id":123456778, "updates":{"title":"my new title", "post":"my new post", "published":false} }' --accountId $YOUR_ACCOUNT_ID

## Delete
- Takes 1 parameter (the id). 
- Delete a blog data that carries that particular id.
- **Example call:** blog-dapp % near call $CONTRACT del '{"id":123456778}' --accountId $YOUR_ACCOUNT_ID

# NEAR-blog-dapp
A blog dapp smart contract written in Assembly Script for NEAR protocol

# 1) What will the project do for the user?
User would be able to add blog post, edit blog post, delete blog post and view blog post. Also view single blog post.

# 2) How are you using the features of NEAR Protocol?
I am using features such as Context, math, PersistentUnorderedMap and assert for testing.

# link
https://app.patika.dev/courses/near-developer-course/submit-your-project-plan

'''
'''--- asconfig.json ---
{
  "extends": "near-sdk-as/asconfig.json"
}
'''
'''--- assembly/as_types.d.ts ---
/// <reference types="near-sdk-as/assembly/as_types" />
'''
'''--- assembly/index.ts ---
import { Blog, PartialBlog } from './model'

export function create(title: string, post: string): Blog {
   return Blog.insert(title, post);
}

export function getById(id: u32): Blog {
  return Blog.findById(id)
}

export function get(offset: u32, limit: u32 = 10): Blog[] {
  return Blog.find(offset, limit);
}

export function update(id: u32, updates: PartialBlog): Blog {
  return Blog.findByIdAndUpdate(id, updates);
}

export function del(id: u32): void {
  Blog.findByIdAndDelete(id);
}
'''
'''--- assembly/model.ts ---
import { Context, math, PersistentUnorderedMap } from "near-sdk-as";

export const blogs = new PersistentUnorderedMap<u32, Blog>("blogs");

@nearBindgen
export class PartialBlog {
    title: string;
    post: string;
    published: bool;
}

@nearBindgen
export class Blog {
    id: u32;
    title: string;
    post: string;
    published: bool;
    author: string;

    constructor(title: string, post: string){
        this.id = math.hash32<string>(title);
        this.title = title;
        this.post = post;
        this.published = true;
        this.author = Context.sender;
    }

    static insert(title: string, post: string): Blog {
        assert(is_valid_string(title), "Title must be a string");
        const blog = new Blog(title, post);
        blogs.set(blog.id, blog);
        return blog;
    }

    static findById(id: u32): Blog {
        assert(is_valid_number(id), "Id must be a string")
        return blogs.getSome(id);
    }

    static find(offset: u32, limit: u32): Blog[] {
        return blogs.values(offset, offset + limit);
    }

    static findByIdAndUpdate(id: u32, partial: PartialBlog): Blog {
        const blog = this.findById(id);

        blog.title = partial.title;
        blog.post = partial.post;

        blogs.set(id, blog);

        return blog;
    }

    static findByIdAndDelete(id: u32): void {
        blogs.delete(id);
    }
}

function is_valid_string(val: string): bool {
    return val.length >= 1;
}

function is_valid_number(val: u32): bool {
    return val >= 0;
}
'''
'''--- assembly/tsconfig.json ---
{
  "extends": "assemblyscript/std/assembly.json",
  "include": [
    "./**/*.ts"
  ]
}
'''
'''--- index.html ---
<!DOCTYPE html>
<html lang="en">
<head>
<script type="module">
import { add } from "./build/release.js";
document.body.innerText = add(1, 2);
</script>
</head>
<body></body>
</html>

'''
'''--- neardev/dev-account.env ---
CONTRACT_NAME=dev-1650124755235-31964966817040
'''
'''--- package.json ---
{
  "name": "blog-dapp",
  "version": "1.0.0",
  "main": "index.js",
  "author": "Kehinde Egunjobi <kehindeegunnjobi93@yahoo.com>",
  "license": "MIT",
  "dependencies": {
    "@assemblyscript/loader": "^0.20.4",
    "asbuild": "^0.2.0",
    "assemblyscript": "^0.20.4",
    "near-cli": "^3.2.0",
    "near-sdk-as": "^3.2.3"
  },
  "type": "module",
  "exports": {
    ".": {
      "import": "./build/release.js",
      "types": "./build/release.d.ts"
    }
  },
  "scripts": {
    "build:release": "asb",
    "deploy": "near dev-deploy build/release/blog-dapp.wasm",
    "dev": "yarn build:release && yarn deploy",
    "test": "asp"
  },
  "devDependencies": {
    "assemblyscript": "^0.20.4"
  }
}
'''
'''--- tests/index.js ---
import assert from "assert";
import { add } from "../build/debug.js";
assert.strictEqual(add(1, 2), 3);
console.log("ok");

'''